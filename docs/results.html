<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Crime in LA - 3&nbsp; Results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./d3graph.html" rel="next">
<link href="./data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./results.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Crime in LA</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/zainab2303/CrimeInLA.git" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./results.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./d3graph.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interactive graph</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#terrifying-twenties" id="toc-terrifying-twenties" class="nav-link active" data-scroll-target="#terrifying-twenties"><span class="header-section-number">3.1</span> Terrifying Twenties…</a></li>
  <li><a href="#stay-off-the-premises" id="toc-stay-off-the-premises" class="nav-link" data-scroll-target="#stay-off-the-premises"><span class="header-section-number">3.2</span> Stay off the Premises!</a></li>
  <li><a href="#society-and-crime" id="toc-society-and-crime" class="nav-link" data-scroll-target="#society-and-crime"><span class="header-section-number">3.3</span> Society and Crime</a></li>
  <li><a href="#weapon-usage-and-crimes-of-sexual-nature" id="toc-weapon-usage-and-crimes-of-sexual-nature" class="nav-link" data-scroll-target="#weapon-usage-and-crimes-of-sexual-nature"><span class="header-section-number">3.4</span> Weapon Usage and Crimes of Sexual Nature</a></li>
  <li><a href="#weapon-usage-and-age-category-of-victim" id="toc-weapon-usage-and-age-category-of-victim" class="nav-link" data-scroll-target="#weapon-usage-and-age-category-of-victim"><span class="header-section-number">3.5</span> Weapon Usage and Age category of Victim</a></li>
  <li><a href="#crime-coordinate-system" id="toc-crime-coordinate-system" class="nav-link" data-scroll-target="#crime-coordinate-system"><span class="header-section-number">3.6</span> Crime Coordinate System</a></li>
  <li><a href="#reporting-crime-and-its-consequences" id="toc-reporting-crime-and-its-consequences" class="nav-link" data-scroll-target="#reporting-crime-and-its-consequences"><span class="header-section-number">3.7</span> Reporting Crime and its Consequences</a></li>
  <li><a href="#masks-covid-19-or-burglar-disguise" id="toc-masks-covid-19-or-burglar-disguise" class="nav-link" data-scroll-target="#masks-covid-19-or-burglar-disguise"><span class="header-section-number">3.8</span> Masks: Covid-19 or Burglar Disguise?</a></li>
  <li><a href="#nocturnal-nature-of-crime" id="toc-nocturnal-nature-of-crime" class="nav-link" data-scroll-target="#nocturnal-nature-of-crime"><span class="header-section-number">3.9</span> Nocturnal Nature of Crime</a></li>
  <li><a href="#mta-most-terrifying-automobile-lines" id="toc-mta-most-terrifying-automobile-lines" class="nav-link" data-scroll-target="#mta-most-terrifying-automobile-lines"><span class="header-section-number">3.10</span> MTA (Most Terrifying Automobile) lines?</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/zainab2303/CrimeInLA.git/edit/main/results.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/zainab2303/CrimeInLA.git/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Results</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="terrifying-twenties" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="terrifying-twenties"><span class="header-section-number">3.1</span> Terrifying Twenties…</h2>
<p>The age of the victim could prove to be useful to understand the psychology of criminals and the high-risk situations that lead to crime against certain individuals. Given in our dataframe is the age as an integer from 0 to 100, and to visualize the distribution of crime occurrence for different age groups, we will plot a histogram, with age bin width of 5 years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df_plot<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">'/Users/anerimodi/Downloads/cleaned.csv'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df_plot[<span class="st">"age_bin"</span>] <span class="ot">=</span> <span class="fu">cut</span>(df_plot<span class="sc">$</span>Vict.Age, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">65</span>, <span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">100</span>), <span class="fu">c</span>(<span class="st">'0-5'</span>, <span class="st">'6-10'</span>, <span class="st">'11-15'</span>, <span class="st">'16-20'</span>, <span class="st">'21-25'</span>,<span class="st">'26-30'</span>,<span class="st">'31-35'</span>,<span class="st">'36-40'</span>,<span class="st">'41-45'</span>,<span class="st">'46-50'</span>,<span class="st">'51-55'</span>,<span class="st">'56-60'</span>,<span class="st">'61-65'</span>,<span class="st">'66-70'</span>,<span class="st">'71-75'</span>,<span class="st">'76-80'</span>,<span class="st">'81-85'</span>,<span class="st">'86-90'</span>,<span class="st">'91-95'</span>,<span class="st">'96-100'</span>), <span class="at">include.lowest=</span><span class="cn">TRUE</span>) <span class="co">#binning the ages into bins</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_plot, <span class="fu">aes</span>(<span class="at">x=</span>Vict.Age)) <span class="sc">+</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span><span class="dv">5</span>, <span class="at">color=</span><span class="st">"darkblue"</span>, <span class="at">fill=</span><span class="st">"cornflowerblue"</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">65</span>, <span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">95</span>, <span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Histogram of Victim Age"</span>,<span class="at">x=</span><span class="st">"Victim Age"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="co">#so that the y axis has readable y ticks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above plot, we can observe that the maximum number of crimes occur against people in the 25-30 age group, and the least committed against very young children below 10.and elder people over the age of 80. In general, young adults are more susceptible to crime as expected, since they are by themselves most of the time in public spaces or in dangerous situations due to the circumstances of work, etc. The twenties seem to be the target age group for most crimes in LA.</p>
</section>
<section id="stay-off-the-premises" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="stay-off-the-premises"><span class="header-section-number">3.2</span> Stay off the Premises!</h2>
<p>On observation, there are 304 Unique premises where crimes take place in our dataframe such as malls, parking lots, MTA railway lines, etc. We will first limit ourselves to the top 6 most frequent premises, and observe whether they form clusters etc through a Biplot visualization where the continuous features of Victim age, Time of Occurrence, Latitude and Longitude are the axes and the graph is drawn on the decomposed version using PCA.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_premise<span class="ot">=</span>df_plot[df_plot<span class="sc">$</span>Premis.Desc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'SINGLE FAMILY DWELLING'</span>, <span class="st">'STREET'</span>, <span class="st">'MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)'</span>,<span class="st">'SIDEWALK'</span>,<span class="st">'VEHICLE, PASSENGER/TRUCK'</span>), ] <span class="co">#filtering only the top 6 premises</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_premise<span class="sc">$</span>Time.of.Occurrence <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(df_premise<span class="sc">$</span>Time.of.Occurrence, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">*</span> <span class="dv">100</span> <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">as.numeric</span>(<span class="fu">substr</span>(df_premise<span class="sc">$</span>Time.of.Occurrence, <span class="dv">4</span>, <span class="dv">5</span>)) <span class="co">#so that we can work with a continuous variable, since right now it is categorical</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(redav)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>df_premise<span class="ot">&lt;-</span>df_premise <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Premis.Desc) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Time.of.Occurrence =</span> <span class="fu">mean</span>(Time.of.Occurrence), <span class="at">Vict.Age =</span> <span class="fu">mean</span>(Vict.Age),<span class="at">LAT=</span><span class="fu">mean</span>(LAT), <span class="at">LON=</span><span class="fu">mean</span>(LON)) <span class="co">#for ease of biplot plotting, we compute the mean of each feature</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_premise<span class="ot">&lt;-</span><span class="fu">subset</span>(df_premise, <span class="at">select=</span><span class="fu">c</span>(<span class="st">'Time.of.Occurrence'</span>,<span class="st">'Vict.Age'</span>,<span class="st">'Premis.Desc'</span>,<span class="st">'LON'</span>,<span class="st">'LAT'</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">draw_biplot</span>(df_premise, <span class="at">arrows=</span><span class="cn">TRUE</span>,<span class="st">"Vict.Age"</span> ) <span class="sc">+</span>  <span class="co">#the age axis is calibrated</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Biplot to visualize Premise details"</span>)<span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>From the above Biplot, we are able to visualize how different premises compare to each other on the basis of the four continuous features: LAT (Latitude), LON (Longitude), Time of Occurrence, and Victim Age. On observation, we can see that the elder people (42 years old) are more at risk to crime in single family dwellings whereas the sidewalk is most risky for comparatively younger people. As for the time of occurrence, since the arrow points in the southeast direction, the street projection lies at the latest time, and is hence most dangerous to walk at night (eg. robbery, chain snatching at night is easier), with dwellings being safer in that regard.</p>
</section>
<section id="society-and-crime" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="society-and-crime"><span class="header-section-number">3.3</span> Society and Crime</h2>
<p>A major goal of our project is aiming to understand the relation between victim sex, victim descent, and the likelihood that given these two features of a person, that crime occurs against them. For this, we will plot a stacked bar chart to see both at the same time, and the proportions that each descent has with respect to sex in our dataset.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_sand<span class="ot">&lt;-</span>df_plot</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_sand<span class="ot">&lt;-</span>df_sand <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Vict.Descent, Vict.Sex) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>(),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="co">#groupby descent and sex, and count the total in each combo</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_sand<span class="sc">$</span>Vict.Descent<span class="ot">=</span><span class="fu">factor</span>(df_sand<span class="sc">$</span>Vict.Descent, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">'H'</span>,<span class="st">'W'</span>,<span class="st">'B'</span>,<span class="st">'A'</span>,<span class="st">'O'</span>)) <span class="co">#reordering the factor levels in decreasing order of freq</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_sand, <span class="fu">aes</span>(<span class="at">fill=</span>Vict.Sex, <span class="at">y=</span>count, <span class="at">x=</span>Vict.Descent)) <span class="sc">+</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">"stack"</span>, <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Crime count per descent for each sex"</span>,<span class="at">x=</span><span class="st">"Victim Descent"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">'cornflowerblue'</span>, <span class="st">'pink'</span>))<span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">'Hispanic'</span>, <span class="st">'White'</span>, <span class="st">'Black'</span>, <span class="st">'Asian'</span>,<span class="st">'Other'</span>)) <span class="co">#labeling with meaningful names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Observing the above stacked bar chart, firstly we notice that most crimes occur against victims of Hispanic descent, and the least against Asians. The ‘Other’ category consists of all the other descents that we grouped during the cleaning stage of our dataset. The proportion of female and males per descent appears to be mostly equal, however there are more crimes that occur against Black females than males, and less to white females than males.</p>
</section>
<section id="weapon-usage-and-crimes-of-sexual-nature" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="weapon-usage-and-crimes-of-sexual-nature"><span class="header-section-number">3.4</span> Weapon Usage and Crimes of Sexual Nature</h2>
<p>[Trigger warning: This portion focuses on crimes involving sexual abuse and rape]</p>
<p>Observing the column of Weapon.Used.Desc, we notice that there are either entries present or they are left blank (which we take to be no weapon used since there is a entry for ‘Unknown’ weapons present in the column already). Hence, we would like to study how the usage of a weapon in the crime depends on the nature of the crime, with us focusing on crimes of sexual nature (that includes rape, sexual abuse, etc). We first filter out such crimes, and then plot the following mosaic plot to understand the association that victim sex, whether it is a crime of sexual nature or not, and the weapon used classification have between them, if any.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="ot">&lt;-</span>df_plot</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="sc">$</span>weapon_used <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df_weapon<span class="sc">$</span>Weapon.Used.Cd <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>) <span class="co">#making a new column based on the original one</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="ot">&lt;-</span> <span class="fu">subset</span>(df_weapon, Crm.Cd.Desc <span class="sc">!=</span> <span class="st">"INCEST (SEXUAL ACTS BETWEEN BLOOD RELATIVES)"</span><span class="sc">&amp;</span>Crm.Cd.Desc <span class="sc">!=</span> <span class="st">"BEASTIALITY, CRIME AGAINST NATURE SEXUAL ASSLT WITH ANIM"</span>) <span class="co">#rare instances, we do not consider these entries</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="sc">$</span>CrimeSexualNature <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"sex|rape"</span>, df_weapon<span class="sc">$</span>Crm.Cd.Desc, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>icecreamcolors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#cc9966"</span>, <span class="st">"lightgreen"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(weapon_used<span class="sc">~</span> Vict.Sex<span class="sc">+</span> CrimeSexualNature, df_weapon,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">"v"</span>,<span class="st">"v"</span> ,<span class="st">"h"</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">highlighting_fill =</span> icecreamcolors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above mosaic plot, we observe that when the crime is of a sexual nature, there are more crimes occurring against females than males, and for the ones against females, majority of them occur with a weapon being used against the victim. Otherwise, the proportion of crimes that use and do not use weapons are equally distributed amongst male and female for crimes of not sexual nature.</p>
</section>
<section id="weapon-usage-and-age-category-of-victim" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="weapon-usage-and-age-category-of-victim"><span class="header-section-number">3.5</span> Weapon Usage and Age category of Victim</h2>
<p>To understand the association of weapon usage with victim age groups and victim sex, we plot a mosaic plot. The ages have been divided into three categories: ‘Child’ comprising of individuals of age less than or equal to 18 years, ‘Young Adult’ comprising of individuals of age 19 to 34 years, and ‘Old Adult’ comprising of ages 35 plus years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="sc">$</span>Victim_Age <span class="ot">&lt;-</span> <span class="fu">case_when</span>(  df_weapon<span class="sc">$</span>Vict.Age <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">'Child'</span>,  <span class="fu">between</span>(df_weapon<span class="sc">$</span>Vict.Age, <span class="dv">19</span>, <span class="dv">34</span>) <span class="sc">~</span> <span class="st">'Young Adult'</span>, df_weapon<span class="sc">$</span>Vict.Age <span class="sc">&gt;=</span> <span class="dv">35</span> <span class="sc">~</span> <span class="st">'Old Adult'</span>) <span class="co">#classifying ages into three categories</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_weapon <span class="ot">&lt;-</span> df_weapon <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Victim_Age<span class="sc">==</span><span class="st">'Child'</span><span class="sc">|</span> Victim_Age<span class="sc">==</span><span class="st">'Young Adult'</span><span class="sc">|</span>Victim_Age<span class="sc">==</span><span class="st">'Old Adult'</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_weapon<span class="sc">$</span>Victim_Age<span class="ot">=</span><span class="fu">factor</span>(df_weapon<span class="sc">$</span>Victim_Age, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">'Child'</span>,<span class="st">'Young Adult'</span>,<span class="st">'Old Adult'</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>icecreamcolors2 <span class="ot">&lt;-</span> <span class="fu">c</span> (<span class="st">"#cc9966"</span>, <span class="st">"lightgreen"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">mosaic</span>(weapon_used<span class="sc">~</span> Vict.Sex<span class="sc">+</span>Victim_Age , df_weapon,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">"v"</span>,<span class="st">"v"</span>,<span class="st">"h"</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">highlighting_fill =</span> icecreamcolors2) <span class="co">#mosaic plot, wre the weapon used is the dependent variable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above mosaic plot, we observe that crimes against children are where weapons are most used, leading to the consideration that it may be because children usually are defenseless victims and are unaware of their surroundings. For adults, both young and old, crimes occur without a weapon majorly. There are also more female child victims than male, but more male old adult victims than female.</p>
</section>
<section id="crime-coordinate-system" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="crime-coordinate-system"><span class="header-section-number">3.6</span> Crime Coordinate System</h2>
<p>To study the spatial variation of crime occurrences and try to understand which areas in Los Angeles are most susceptible to crime, we firstly proceed by removing the rows that have 0 as LON or LAT, since that was a preprocessing done by the dataset providers when the longitude and latitude was not identified. After this, we move on to bin the crime instances into 30 hex bins, and observe the spatial distribution of crimes in the form of a heat map.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_area <span class="ot">&lt;-</span> df_plot <span class="sc">%&gt;%</span> <span class="fu">filter</span>(LON <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">|</span> LAT <span class="sc">!=</span> <span class="dv">0</span>)  <span class="co">#excluding these entries</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">data=</span>df_area, <span class="co">#hexmap</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>LON, <span class="at">y=</span>LAT), <span class="at">bins=</span><span class="dv">30</span>, <span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_fermenter</span>(<span class="at">n.breaks=</span><span class="dv">10</span>,<span class="at">palette =</span> <span class="st">"viridis"</span>)<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Spatial variation of crime occurrence"</span>)<span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown palette: "viridis"</code></pre>
</div>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above map, we observe that eastern and slightly central LA have higher cases of crime occurring than the left and south parts of LA. Comparing this heatmap to an actual land map (<a href="https://www.zeemaps.com/world-of-maps/map-of-la/">See here for land map</a> ), in particular the areas of South and Downtown LA are high-crime areas, with more than 10,000 cases occurring in that bin over three years.</p>
</section>
<section id="reporting-crime-and-its-consequences" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="reporting-crime-and-its-consequences"><span class="header-section-number">3.7</span> Reporting Crime and its Consequences</h2>
<p>To investigate this aspect of crime involving fear or shame of a victim in reporting crime, we will plot an Alluvial diagram that represents the flow of crime instances across Victim Sex, the difference in date reported and date occurred of the crime, and the status of the crime that was reported (whether the investigation is still continuing or the adult has been arrested). Due to less cases in juvenile perpetrators and unknowns and the ambiguity of ‘Adult Other’ category, we will focus only on the two categories of status of crime. The difference in dates reported have been classified into three options: Instant (where the crime is instantly reported on the same exact day as committed), 1 year (when the difference is less than 365 days), and 2 years (when the difference is less than 730 days but more than a year).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_diff<span class="ot">&lt;-</span>df_plot</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_diff<span class="sc">$</span>difference<span class="ot">&lt;-</span><span class="fu">as.Date</span>(df_diff<span class="sc">$</span>Date_Reported)<span class="sc">-</span><span class="fu">as.Date</span>(df_diff<span class="sc">$</span>Date_Occurred) <span class="co">#to get the difference in number of days</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_diff<span class="sc">$</span>difference <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_diff<span class="sc">$</span>difference)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#categorizing the differences</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df_diff<span class="sc">$</span>difference[df_diff<span class="sc">$</span>difference<span class="sc">==</span><span class="dv">0</span> ]<span class="ot">&lt;-</span><span class="st">'Instant'</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df_diff<span class="sc">$</span>difference[df_diff<span class="sc">$</span>difference<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> df_diff<span class="sc">$</span>difference<span class="sc">&lt;=</span><span class="dv">365</span>]<span class="ot">&lt;-</span><span class="st">'Within 1 year'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>df_diff<span class="sc">$</span>difference[df_diff<span class="sc">$</span>difference<span class="sc">&gt;=</span><span class="dv">366</span> <span class="sc">&amp;</span> df_diff<span class="sc">$</span>difference<span class="sc">&lt;=</span><span class="dv">730</span>]<span class="ot">&lt;-</span><span class="st">'Within 2 years'</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df_diff <span class="ot">&lt;-</span> df_diff <span class="sc">%&gt;%</span> <span class="fu">filter</span>(difference<span class="sc">==</span><span class="st">'Instant'</span><span class="sc">|</span> difference<span class="sc">==</span><span class="st">'Within 1 year'</span><span class="sc">|</span>difference<span class="sc">==</span><span class="st">'Within 2 years'</span>) </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>df_diff <span class="ot">&lt;-</span> df_diff <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Status.Desc<span class="sc">==</span><span class="st">'Adult Arrest'</span><span class="sc">|</span>Status.Desc<span class="sc">==</span><span class="st">'Invest Cont'</span>) </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>df_diff<span class="ot">&lt;-</span>df_diff <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Vict.Sex,Status.Desc,difference) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>(),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalluvial)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_diff, <span class="fu">aes</span>(<span class="at">axis1 =</span>Vict.Sex , <span class="at">axis2 =</span> difference, <span class="at">axis3 =</span> Status.Desc, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_alluvium</span>(<span class="at">color=</span><span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_stratum</span>() <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">"stratum"</span>, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="fu">after_stat</span>(stratum), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Sex"</span>, <span class="st">"Time taken to report"</span>, <span class="st">"Current status"</span>))<span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma)<span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Alluvial diagram"</span>)<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the alluvial plot wil have the axis as the categorical vars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From the above alluvial diagram, on observing the flow from victim sex all the way to the end which is the status of the crime, we notice that firstly most of the adult arrests status crimes have resulted when the crime was reported instantly and very few result from those that have been reported 1-2 years after the crime (giving us some idea on the importance of immediate evidence needed in most cases). Mostly all cases reported after a year have their investigation still continuing. Secondly, out of all the Female victims, less than half report instantly, and the rest take more time than that, whereas it is the opposite for male victims where more than half report instantly.</p>
</section>
<section id="masks-covid-19-or-burglar-disguise" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="masks-covid-19-or-burglar-disguise"><span class="header-section-number">3.8</span> Masks: Covid-19 or Burglar Disguise?</h2>
<p>Taking advantage of the fact that we have a dataset that comprises of crime across years 2020 to present (2023), we will attempt to understand the affect the pandemic had on crime in LA. To do so, we plot a faceted time series plot across each year from 2020 to 2023 (which ends in November since we downloaded the dataset in November), and observe the crime count for each month extracted from the Date of occurrence column.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_covid<span class="ot">&lt;-</span>df_plot</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_covid<span class="sc">$</span>Year_Occurred<span class="ot">&lt;-</span>lubridate<span class="sc">::</span><span class="fu">year</span>(df_covid<span class="sc">$</span>Date_Occurred) <span class="co">#use lubridate to extract the year from the date class</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>df_covid<span class="sc">$</span>Month_Occurred<span class="ot">&lt;-</span>lubridate<span class="sc">::</span><span class="fu">month</span>(df_covid<span class="sc">$</span>Date_Occurred)<span class="co">#use lubridate to extract the month from the date class</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_covid<span class="ot">&lt;-</span>df_covid <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year_Occurred,Month_Occurred) <span class="sc">%&gt;%</span> <span class="co">#groupby the year and month so that the line plot is at same points on months</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_per_month=</span><span class="fu">n</span>(),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_covid, <span class="fu">aes</span>(Month_Occurred, total_per_month)) <span class="sc">+</span>  </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">'blue'</span>, <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Year_Occurred,<span class="at">ncol=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Yearly trend in crime"</span>,<span class="at">x=</span><span class="st">"Month"</span>, <span class="at">y =</span> <span class="st">"Total Count"</span>)<span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span><span class="st">"Month"</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">limits=</span><span class="fu">c</span>(<span class="st">'Jan'</span>,<span class="st">'Feb'</span>,<span class="st">'Mar'</span>,<span class="st">'Apr'</span>,<span class="st">'May'</span>,<span class="st">'Jun'</span>,<span class="st">'Jul'</span>,<span class="st">'Aug'</span>,<span class="st">'Sep'</span>,<span class="st">'Oct'</span>,<span class="st">'Nov'</span>,<span class="st">'Dec'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_line(color = "blue", breaks = c(1, 2, 3, 4, 5, 6, 7, 8, :
Ignoring unknown parameters: `breaks`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We observe that for the first part of 2020, there is crime count of more than 10,000 and a slight decrease, but from March onwards there is no significant change in the trend which may be because the pandemic was a very uncertain time at the beginning when nobody left their houses. Such situations would mean that there would be less robberies and crime occurring because of lack of people to attack in public spaces. In 2021, the trend is continued at the beginning, but then rises significantly and is at an all time high in 2022 where we faced the second wave of the pandemic. This period of time was chaotic and people were desperate for resources and food given the shortages in many parts of the US. This may be a reason for this rise, where cases are above 14,000 for the majority of 2022. Then, in 2023, there are less cases that occurred, however since we are in the current year, it may be that people have not reported the crimes yet and hence there are less entries in the 2023 year.</p>
</section>
<section id="nocturnal-nature-of-crime" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="nocturnal-nature-of-crime"><span class="header-section-number">3.9</span> Nocturnal Nature of Crime</h2>
<p>Curious to verify whether most crime instances occur when it is dark outside and at nightfall when the security is at low task force, we plot a histogram of the time of occurrence of crime, binning the time into hours. Hour 1 corresponds to 12:00 am midnight to 1:00 am, and Hour 24 corresponds to 11:00pm to 12:00 am.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plotting histogram</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_night<span class="ot">&lt;-</span>df_plot</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_night<span class="sc">$</span>Time.of.Occurrence <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(df_night<span class="sc">$</span>Time.of.Occurrence, <span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">*</span> <span class="dv">100</span> <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">as.numeric</span>(<span class="fu">substr</span>(df_night<span class="sc">$</span>Time.of.Occurrence, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df_night[<span class="st">"time_bin"</span>] <span class="ot">=</span> <span class="fu">cut</span>(df_night<span class="sc">$</span>Time.of.Occurrence, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">800</span>, <span class="dv">900</span>, <span class="dv">1000</span>, <span class="dv">1100</span>, <span class="dv">1200</span>, <span class="dv">1300</span>, <span class="dv">1400</span>, <span class="dv">1500</span>, <span class="dv">1600</span>, <span class="dv">1700</span>, <span class="dv">1800</span>, <span class="dv">1900</span>, <span class="dv">2000</span>, <span class="dv">2100</span>, <span class="dv">2200</span>, <span class="dv">2300</span>, <span class="dv">2400</span>), <span class="fu">c</span>(<span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span>,<span class="st">'4'</span>,<span class="st">'5'</span>,<span class="st">'6'</span>,<span class="st">'7'</span>,<span class="st">'8'</span>,<span class="st">'9'</span>,<span class="st">'10'</span>,<span class="st">'11'</span>,<span class="st">'12'</span>,<span class="st">'13'</span>,<span class="st">'14'</span>,<span class="st">'15'</span>,<span class="st">'16'</span>,<span class="st">'17'</span>,<span class="st">'18'</span>,<span class="st">'19'</span>,<span class="st">'20'</span>,<span class="st">'21'</span>,<span class="st">'22'</span>,<span class="st">'23'</span>,<span class="st">'24'</span>), <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_night, <span class="fu">aes</span>(<span class="at">x=</span>time_bin)) <span class="sc">+</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>( <span class="at">stat=</span><span class="st">'count'</span>, <span class="at">color=</span><span class="st">"darkblue"</span>, <span class="at">fill=</span><span class="st">"cornflowerblue"</span>)<span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Histogram of Crime count"</span>,<span class="at">x=</span><span class="st">"Hour of the day"</span>, <span class="at">y =</span> <span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_histogram(stat = "count", color = "darkblue", fill =
"cornflowerblue"): Ignoring unknown parameters: `binwidth`, `bins`, and `pad`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As expected, there is a dip in the crime committed during the early hours of the morning (from 3 AM to 7 AM), after which crime instances continuously rise and stay at that range till 10 PM. The hour before midnight sees a dip in crime, but then after midnight, the crime peaks to around 35,000 total counts (which is the second highest amount throughout the day). An anomaly we notice is clearly the huge peak in time of occurrence of crime at noon, which we also suspect could be because of lack of reporting time in some crime cases, for which the police department may enter 12:00 as the dummy time, and hence it falls in this bin.</p>
</section>
<section id="mta-most-terrifying-automobile-lines" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="mta-most-terrifying-automobile-lines"><span class="header-section-number">3.10</span> MTA (Most Terrifying Automobile) lines?</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_mta<span class="ot">&lt;-</span>df_plot</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_mta <span class="ot">&lt;-</span> df_mta <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">sapply</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(df_mta<span class="sc">$</span>Premis.Desc), <span class="st">" "</span>), <span class="cf">function</span>(x) x[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">'MTA'</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>df_mta <span class="ot">&lt;-</span> df_mta <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Premis.Desc<span class="sc">!=</span><span class="st">'MTA BUS'</span><span class="sc">&amp;</span> Premis.Desc<span class="sc">!=</span><span class="st">'MTA PROPERTY OR PARKING LOT'</span>) <span class="co">#filtering out the MTA line premises</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>getFirstFewWords <span class="ot">&lt;-</span> <span class="cf">function</span>(text, <span class="at">n =</span> <span class="dv">3</span>) { <span class="co">#to extract the line color from the premis</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  words <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(text, <span class="st">" "</span>)[[<span class="dv">1</span>]]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(words[<span class="dv">1</span><span class="sc">:</span>n], <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to create a new column</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>df_mta <span class="ot">&lt;-</span> df_mta <span class="sc">%&gt;%</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">railline =</span> <span class="fu">sapply</span>(Premis.Desc, getFirstFewWords)) <span class="co">#grouping all colors together</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>df_mta<span class="ot">&lt;-</span>df_mta <span class="sc">%&gt;%</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(railline) <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>(),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">'drop'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>On observation of the unique values of crimes occurring on the MTA lines, there are the following color lines: Orange, Purple, Green, Blue, Red, Silver, Expo, Gold and the Bus and Parking Lot. We remove those that occur in the Bus and Parking Lot, since we want to concentrate on the railway line. Also, the MTA bus has the highest cases of crime occurring, and appears to be an outlier when we plot the Cleveland Dot plot, so for better visualization, we focus on the railways.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MTA - RED"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"MTA - BLUE"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"MTA - GREEN"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"MTA - GOLD"</span> <span class="ot">=</span> <span class="st">"gold"</span>,<span class="st">"MTA - SILVER"</span> <span class="ot">=</span> <span class="st">"grey"</span>, <span class="st">"MTA - PURPLE"</span> <span class="ot">=</span> <span class="st">"purple"</span>, <span class="st">"MTA - ORANGE"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"MTA - EXPO"</span> <span class="ot">=</span> <span class="st">"black"</span>) <span class="co">#color coding the lines</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_mta, <span class="fu">aes</span>(<span class="at">x =</span> count, <span class="at">y =</span> <span class="fu">fct_reorder</span>(railline, count))) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> custom_colors[df_mta<span class="sc">$</span>railline]) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Crime count for each MTA line"</span>,<span class="at">x=</span><span class="st">"Count"</span>, <span class="at">y =</span> <span class="st">"MTA line"</span>)<span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>), <span class="at">legend.position =</span> <span class="st">"none"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="results_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above Cleveland dot plot, we can infer that the Red line is the most dangerous in terms of number of crimes occurring throughout the dataset. This maybe because it is the most frequently used, or is not properly monitored with inefficient security resources. The line of least crime occurrences is the silver one. The red line has over 2000 crimes that occurred on it in the past three years, whereas the others have less than 1000 crimes at their locations, pointing out a great difference in the MTA lines.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./d3graph.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Interactive graph</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>